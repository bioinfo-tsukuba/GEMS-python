# Plugin Manager

This readme file is automatically generated.

## 概要

このプロジェクトは、Pythonで動的なプラグイン管理を提供する `PluginManager` と、ユーザーがコマンドラインインターフェース (CLI) でプラグインの管理・実験プロトコルの操作を行うための `PluginCmd` を実装しています。  
プラグインの自動ロードや、インタラクティブなコマンドライン操作による管理が可能です。

## 特徴

- **動的プラグイン管理**: 新しいプラグインの作成や更新時に自動で読み込み・再読み込みを行います。
- **CLIインターフェース**: `cmd2` ベースのコマンドラインインターフェースで、プラグインや実験の操作が可能です。
- **自動ロード機能**: ユーザーが指定しない場合、一定時間無操作が続くとプラグインを自動ロードします。
- **スレッド管理**: バックグラウンドでの自動処理と、ユーザー操作のスレッド間保護を実現しています。

---

## インストールと実行

### 必要なライブラリ

以下のPythonパッケージをインストールする必要があります。

```bash
pip install watchdog cmd2
```

また、`transition_manager` モジュールを適切にインストールするか、`Experiments` および `Experiment` クラスが参照できることを確認してください。

### 実行方法

1. このプロジェクトをクローンまたはダウンロードします。
2. `main()` 関数を持つスクリプトを以下のように実行します:

```bash
python your_script_name.py
```

---

## 使用方法

### プラグインの管理

プラグインのPythonファイルを `experimental_setting/` ディレクトリに配置することで、以下の操作が可能です。

- **自動ロード**: `.py` ファイルの新規作成または変更を検出し、自動でプラグインをロードまたは再読み込みします。
- **手動でのプラグイン追加**:

  ```bash
  add <module.class>
  ```

### 利用可能なコマンド

CLI上で以下のコマンドが利用できます。

- `add <module.class>`: プラグインから指定されたクラスを追加します。
- `show`: 現在追加されているクラスを表示します。
- `schedule`: クラスのリストをクリアします。
- `cmdlist`: 使用可能なコマンドの一覧を表示します。
- `stop`: 自動ロード機能を停止します。
- `reloop`: 自動ロード機能を再開します。
- `exit` または `EOF`: プログラムを終了します。

---

## コード構造

### `PluginManager` クラス

- **`start()`**: プラグインのスキャンを開始し、監視を有効化します。
- **`stop()`**: 監視を停止します。
- **`load_plugin(file_path)`**: プラグインをロードまたは再読み込みします。
- **`add_experiment_cmd()`**: 指定したクラスを実験リストに追加します。

### `PluginCmd` クラス

- **`monitor_inactivity()`**: 無操作状態を監視し、自動ロードをトリガーします。
- **`do_add()`**: クラスを実験に追加します。
- **`do_show()`**: 追加されたクラスを表示します。
- **`do_stop()`**: 自動ロードを停止します。
- **`do_reloop()`**: 自動ロードを再開します。
- **`cmdloop()`**: コマンドループを実行し、ユーザー操作を待機します。

---

## 実行例

```bash
plugin_manager> add example_module.ExampleClass
plugin_manager> show
plugin_manager> stop
plugin_manager> reloop
plugin_manager> exit
```

---

## 注意点

- **プラグインのパス**: プラグインのPythonファイルは `experimental_setting/` ディレクトリ内に配置する必要があります。
- **ライブラリの依存関係**: 使用する外部モジュールのインストールが必要です。
- **スレッドセーフな処理**: スレッド間で共有する変数は適切にロックして操作します。

---

## 今後の改善点

- エラーハンドリングの強化（無効なモジュール名やクラスが指定された場合の処理）
- ユーザーインターフェースの拡充（コマンドの補完機能など）
- プラグインの管理に関する詳細なログ出力

---

## お問い合わせ

このプロジェクトに関する質問がある場合は、プロジェクトメンテナにお問い合わせください。
